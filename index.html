<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Check-in / Check-out</title>
  <style>
    body { font-family: Arial; text-align: center; padding: 30px; }
    input { font-size: 18px; padding: 10px; margin: 8px; width: 80%; }
    button { font-size: 20px; padding: 15px; margin: 10px; width: 85%; cursor: pointer; }
    #msg { margin-top: 20px; font-weight: bold; color: green; }
    /* Скрытый iframe, чтобы страница не перезагружалась при отправке */
    #hidden_iframe { display: none; }
  </style>
</head>
<body>

<h2>Регистрация входа / выхода</h2>

<!-- Форма без target="hidden_iframe" для 100% срабатывания на смартфонах -->
<form id="regForm" action="https://script.google.com/macros/s/AKfycbyTVf3sKu6UsTkSYx2i7cmEwlIgrIdWhnTIcTxaTJhVD_2jDwUofIxyFgwVCf_EYrPm/exec" method="GET" onsubmit="return handleWait()">
  <input type="hidden" name="type" id="typeInput">
  <input name="name" id="name" placeholder="Имя" required>
  <input name="surname" id="surname" placeholder="Фамилия" required>
  <br>
  <button type="button" onclick="submitForm('enter')">ВХОД</button>
  <button type="button" onclick="submitForm('exit')">ВЫХОД</button>
</form>

<p id="msg"></p>

<!-- Сюда придет ответ от Google, который мы не увидим, но форма сработает -->
<iframe name="hidden_iframe" id="hidden_iframe" onload="if(submitted) showSuccess()"></iframe>

<script>
  let submitted = false;
  let currentType = '';

  function submitForm(type) {
    const name = document.getElementById("name").value.trim();
    const surname = document.getElementById("surname").value.trim();
    
    if (!name || !surname) {
      alert("Введите имя и фамилию");
      return;
    }

    submitted = true;
    currentType = type;
    document.getElementById("typeInput").value = type;
    document.getElementById("msg").innerText = "Отправка...";
    document.getElementById("regForm").submit();
  }

  function showSuccess() {
    if (submitted) {
      const msgEl = document.getElementById("msg");
      msgEl.style.color = "green";
      msgEl.innerText = "Успешно: " + (currentType === 'enter' ? "ВХОД" : "ВЫХОД") + " зафиксирован!";
      document.getElementById("name").value = "";
      document.getElementById("surname").value = "";
      submitted = false;
    }
  }
</script>

</body>
</html>
